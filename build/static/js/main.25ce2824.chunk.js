(this.webpackJsonpspiritislandweb=this.webpackJsonpspiritislandweb||[]).push([[0],{104:function(e,t,a){},110:function(e,t,a){},111:function(e,t,a){},122:function(e,t,a){},123:function(e,t,a){},124:function(e,t,a){},125:function(e,t,a){},150:function(e,t){},154:function(e,t,a){"use strict";a.r(t);var n=a(1),i=a.n(n),r=a(88),o=a.n(r),s=a(0),c=a(5),l=a(6),u=a(13),b=a(7),h=a(8),d=(a(104),a(157)),m=a(158),p=a(12),j=a(25),O=a.n(j),y=a(34),v=a.n(y),f=a(38),g=a(2),x=i.a.forwardRef((function(e,t){var a=e.className,n=e.theme,i=void 0===n?"orange":n,r=e.size,o=void 0===r?"medium":r,c=Object(p.a)(e,["className","theme","size"]);return Object(g.jsx)("button",Object(s.a)({ref:t,className:O()(v.a.button,v.a["button--".concat(i)],v.a["button--size-".concat(o)],a)},c))})),S=function(e){var t=e.className,a=e.theme,n=void 0===a?"orange":a,i=e.size,r=void 0===i?"medium":i,o=Object(p.a)(e,["className","theme","size"]);return Object(g.jsx)(f.b,Object(s.a)({className:O()(v.a.button,v.a["button--".concat(n)],v.a["button--size-".concat(r)],t)},o))},_=a(55),k=a.n(_),D=a.p+"static/media/SpiritIslandLogo.49f6bb3e.png",I=(a(110),function(e){var t=e.size,a=e.className,n=Object(p.a)(e,["size","className"]);return Object(g.jsx)("img",Object(s.a)({src:D,alt:"Spirit Island Logo",className:O()("Logo","Logo--".concat(t),a)},n))}),C=function(e){var t=e.className,a=e.children,n=Object(p.a)(e,["className","children"]);return Object(g.jsxs)("div",Object(s.a)(Object(s.a)({className:O()(k.a.lobbyPage,t)},n),{},{children:[Object(g.jsx)(w,{}),a]}))},N=function(){return Object(g.jsx)("a",{href:"/",children:Object(g.jsx)(I,{size:"small",className:k.a.smallLogo})})},w=function(){return Object(g.jsx)("a",{className:k.a.githubLink,href:"https://github.com/maddinpsy/spiritislandweb",target:"_blank",rel:"noopener noreferrer",children:"Github"})},R=a(93),L=a(74),T=a(29),E=a(90),M=window.location,P=(Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).PORT,M.protocol,M.hostname,origin),q=["en"];L.a.use(T.e).use(E.a).init({resources:{},fallbackLng:"en",debug:!1,keySeparator:!1,interpolation:{escapeValue:!1}});L.a,a(111);var G=function(){var e=Object(R.a)().i18n;return Object(g.jsx)("div",{className:"Lang",children:q.map((function(t){return Object(g.jsx)("button",{className:O()("Lang__button",e.language.split("-")[0]===t&&"Lang__button--active"),onClick:function(){e.changeLanguage(t),window.location.reload()},children:t},t)}))})},z=a(94),A=a.n(z),V=function(e){var t=e.type,a=void 0===t?"text":t,n=e.className,i=Object(p.a)(e,["type","className"]);return Object(g.jsx)("input",Object(s.a)({className:O()(A.a.input,n),type:a},i))},B=function(e){Object(b.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={nickname:n.props.nickname||""},n.handleChanged=n.handleChanged.bind(Object(u.a)(n)),n.handleSubmit=n.handleSubmit.bind(Object(u.a)(n)),n}return Object(l.a)(a,[{key:"handleChanged",value:function(e){this.setState({nickname:e})}},{key:"handleSubmit",value:function(e){e.preventDefault(),this.props.onSubmit&&this.props.onSubmit(this.state.nickname)}},{key:"render",value:function(){var e=this;return Object(g.jsxs)(C,{children:[Object(g.jsx)(G,{}),Object(g.jsx)(N,{}),Object(g.jsx)("h3",{className:"SetupNickname__title",children:Object(g.jsx)(d.a,{children:"Set your nickname"})}),Object(g.jsxs)("form",{onSubmit:this.handleSubmit,className:"SetupNickname__form",children:[Object(g.jsx)(V,{placeholder:this.props.t("Type in something cool..."),className:"SetupNickname__input",onChange:function(t){return e.handleChanged(t.target.value)},value:this.state.nickname}),Object(g.jsx)(x,{type:"submit",children:Object(g.jsx)(d.a,{children:"Save"})}),Object(g.jsx)(x,{onClick:function(){e.props.onBack()},children:Object(g.jsx)(d.a,{children:"Back"})})]})]})}}]),a}(n.Component),J=Object(m.a)()(B),W=a(11),H=a(96),K=a(56),U=a(98),F={name:"SpiritIsland",minPlayers:1,maxPlayers:99},Q=function(e){Object(b.a)(a,e);var t=Object(h.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"render",value:function(){return this.props.matchData?Object(g.jsx)("div",{children:"Hello World"}):Object(g.jsx)("div",{children:'"this.props.matchData is not defined."'})}}]),a}(n.Component),Y=(a(122),function(e){Object(b.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(c.a)(this,a),n=t.call(this,e),""===e.nickname.trim()?e.requestChangeNickname():e.onCreateGameRoom(),n}return Object(l.a)(a,[{key:"render",value:function(){var e=this.props.roomID;return e?Object(g.jsx)(W.a,{to:"/rooms/".concat(e)}):Object(g.jsxs)(C,{children:[Object(g.jsx)(N,{}),Object(g.jsx)(G,{}),Object(g.jsx)("h3",{className:"CreateGame__title",children:Object(g.jsx)(d.a,{children:"Creating new game..."})})]})}}]),a}(i.a.Component)),X=a(20),Z=(a(123),a(124),function(e){Object(b.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).supportsCopying=!1,n.state={tooltipVisible:!1},n.supportsCopying=!!document.queryCommandSupported("copy"),n.copyToClipboard=n.copyToClipboard.bind(Object(u.a)(n)),n.setTooltipVisible=n.setTooltipVisible.bind(Object(u.a)(n)),n}return Object(l.a)(a,[{key:"copyToClipboard",value:function(e){var t=document.createElement("textarea");t.innerText=e,t.style.opacity="0",document.body.appendChild(t),t.select(),document.execCommand("copy"),t.remove()}},{key:"setTooltipVisible",value:function(e){this.setState({tooltipVisible:e})}},{key:"render",value:function(){var e=this;return Object(g.jsxs)("div",{className:"LobbyLink__link",children:[Object(g.jsx)("div",{className:"LobbyLink__link-box",children:window.location.href}),this.supportsCopying&&Object(g.jsxs)("div",{className:"LobbyLink__link-button",children:[this.state.tooltipVisible&&Object(g.jsx)("div",{className:"LobbyLink__tooltip",children:Object(g.jsx)(d.a,{children:"Copied!"})}),Object(g.jsx)(x,{onClick:function(){e.copyToClipboard(window.location.href),e.setTooltipVisible(!0),setTimeout((function(){return e.setTooltipVisible(!1)}),1500)},children:Object(g.jsx)(d.a,{children:"Copy"})})]})]})}}]),a}(i.a.Component)),$=function(e){Object(b.a)(a,e);var t=Object(h.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"onRequestStart",value:function(){if(!F.name)throw new Error("IllegalState game name not set");if(!this.props.playerData)throw new Error("playerData is undefined, pleas join the game befor starting.");this.setState({startRequested:!0}),this.props.lobbyClient.updatePlayer(F.name,this.props.matchID,{playerID:String(this.props.playerData.playerID),credentials:this.props.playerData.credential,data:{gameStarted:!0}}).catch((function(e){alert("There was a problem, while starting the game. Please try again."),console.log("Error starting game:"+e)}))}},{key:"render",value:function(){var e=this,t=void 0;return this.props.isCreator&&(t=Object(g.jsx)(x,{onClick:function(){e.onRequestStart()},children:Object(g.jsx)(d.a,{children:"Start Game"})})),Object(g.jsx)("div",{className:"Lobby__status-message",children:this.props.gameStarted?Object(g.jsx)(d.a,{children:"Starting Game..."}):t})}}]),a}(i.a.Component);var ee,te=function(e){Object(b.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).matchID=void 0,n.gameStarted=!1,""===e.nickname.trim()&&e.requestChangeNickname(),n.matchID=e.match.params.id,n.findSeatAndJoin=n.findSeatAndJoin.bind(Object(u.a)(n)),n.join=n.join.bind(Object(u.a)(n)),n}return Object(l.a)(a,[{key:"componentDidUpdate",value:function(e){var t=this;if(this.props.roomMetadata&&this.props.roomMetadata!==e.roomMetadata){var a;this.findSeatAndJoin();var n=Object.entries(this.props.roomMetadata.players).map((function(e){var t=Object(X.a)(e,2);t[0];return t[1]}));this.gameStarted=(null===(a=this.props.roomMetadata.players[0].data)||void 0===a?void 0:a.gameStarted)||!1;var i=n.find((function(e){var a;return e.id===(null===(a=t.props.playerData)||void 0===a?void 0:a.playerID)&&e.name===t.props.nickname}));if(this.gameStarted){if(!i)return alert("This game started without you."),void this.props.history.push("/");this.delayedStart()}}}},{key:"join",value:function(e){var t=this;if(!F.name)throw new Error("IllegalState game name not set");var a=this.props.lobbyClient.joinMatch(F.name,this.matchID,{playerID:String(e),playerName:this.props.nickname});a.then((function(a){t.props.storePlayerData({playerID:e,credential:a.playerCredentials,matchID:t.matchID})})),a.catch((function(e){alert("There was a problem. Make sure you have the right url and try again."),console.log("Error joining room:"+e),t.props.history.push("/")}))}},{key:"findSeatAndJoin",value:function(){var e,t=this;if(!this.matchID)throw new Error("IllegalState matchID not set");if(!F.name)throw new Error("IllegalState game name not set");if(!this.props.roomMetadata)throw new Error("IllegalState roomMetadata not set");var a=Object.entries(this.props.roomMetadata.players).map((function(e){var t=Object(X.a)(e,2);t[0];return t[1]})),n=null===(e=a.find((function(e){return!e.name})))||void 0===e?void 0:e.id;!a.find((function(e){var a;return e.id===(null===(a=t.props.playerData)||void 0===a?void 0:a.playerID)&&e.name===t.props.nickname}))&&void 0!==n&&this.props.nickname&&this.matchID&&this.join(n)}},{key:"delayedStart",value:function(){var e=this;window.setTimeout((function(){if(!e.props.roomMetadata)return alert("There was an internal problem. Please try again."),void e.props.history.push("/");e.props.startGame()}),2e3)}},{key:"render",value:function(){var e,t=this,a=[];return this.props.roomMetadata&&(a=Object.entries(this.props.roomMetadata.players).map((function(e){var t=Object(X.a)(e,2);t[0];return t[1]}))),Object(g.jsxs)(C,{children:[Object(g.jsx)(N,{}),Object(g.jsx)(G,{}),Object(g.jsx)("div",{className:"Lobby__title",children:Object(g.jsx)(d.a,{children:"Invite Players"})}),Object(g.jsx)("div",{className:"Lobby__subtitle",children:Object(g.jsx)(d.a,{children:"Send a link to your friends to invite them to your game"})}),Object(g.jsx)(Z,{}),Object(g.jsx)("div",{className:"Lobby__players",children:this.props.roomMetadata?a.filter((function(e){return e.name})).map((function(e){return Object(g.jsxs)("div",{className:"Lobby__player Lobby__player--active",children:[e.name," ",e.name===t.props.nickname&&"(You)"]},e.id)})):Object(g.jsx)(d.a,{children:"Loading..."})}),Object(g.jsx)($,{gameStarted:this.gameStarted,isCreator:0===(null===(e=this.props.playerData)||void 0===e?void 0:e.playerID)||!1,matchID:this.matchID,playerData:this.props.playerData,lobbyClient:this.props.lobbyClient})]})}}]),a}(i.a.Component),ae=Object(W.g)((ee=te,function(e){Object(b.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).matchID=void 0,n.timerID=void 0,n.matchID=e.match.params.id,n.state={roomMetadata:void 0},n.loadRoomMetadata=n.loadRoomMetadata.bind(Object(u.a)(n)),n}return Object(l.a)(a,[{key:"componentDidMount",value:function(){var e=this;this.timerID=window.setInterval((function(){return e.loadRoomMetadata()}),500)}},{key:"componentWillUnmount",value:function(){this.timerID&&window.clearInterval(this.timerID)}},{key:"loadRoomMetadata",value:function(){var e=this;if(!this.matchID)throw new Error("IllegalState matchID not set");if(!F.name)throw new Error("IllegalState game name not set");this.props.lobbyClient.getMatch(F.name,this.matchID).then((function(t){e.setState({roomMetadata:t})})).catch((function(t){alert("There was a problem. Make sure you have the right url and try again."),console.log("Error in loadRoomMetadata: "+t),e.props.history.push("/")}))}},{key:"render",value:function(){return Object(g.jsx)(ee,Object(s.a)(Object(s.a)({},this.props),{},{roomMetadata:this.state.roomMetadata}))}}]),a}(i.a.Component))),ne=a(71),ie=a.n(ne),re=function(){return Object(g.jsxs)(C,{children:[Object(g.jsx)(I,{className:ie.a.logo,size:"large"}),Object(g.jsx)("p",{className:ie.a.text,children:Object(g.jsx)(d.a,{children:"Spirit Island is a cooperative, settler-destruction strategy game for 1 to 4 players designed by R. Eric Reuss and set in an alternate-history world around A.D. 1700."})}),Object(g.jsx)(S,{to:"/create",theme:"orange",children:Object(g.jsx)(d.a,{children:"Go!"})})]})},oe=(a(125),"SPIRITISLANDWEB_CLIENT_CREDENTIALS"),se=function(e){Object(b.a)(a,e);var t=Object(h.a)(a);function a(e){var n;Object(c.a)(this,a),(n=t.call(this,e)).lobbyClient=void 0,n.lobbyClient=new H.a({server:P});var i,r=localStorage.getItem(oe);return r&&(i=JSON.parse(r)),n.state={playerData:i,isRunning:!1},n.newGame=n.newGame.bind(Object(u.a)(n)),n.storePlayerData=n.storePlayerData.bind(Object(u.a)(n)),n.startGame=n.startGame.bind(Object(u.a)(n)),n}return Object(l.a)(a,[{key:"newGame",value:function(){var e=this;if(!F.name)throw new Error("IllegalState game name not set");this.lobbyClient.createMatch(F.name,{numPlayers:F.maxPlayers||4}).then((function(t){e.setState({matchID:t.matchID})})).catch((function(e){alert("There was a problem creating the match. Please try again."),console.log("Error creating new Game:"+e)}))}},{key:"storePlayerData",value:function(e){localStorage.setItem(oe,JSON.stringify(e)),this.setState({playerData:e})}},{key:"startGame",value:function(){this.setState({isRunning:!0})}},{key:"render",value:function(){var e,t=this.state.matchID;if(this.state.isRunning){var a,n,i,r=Object(U.a)({game:F,board:Q,multiplayer:Object(K.b)({server:P})});e=Object(g.jsx)(r,{matchID:null===(a=this.state.playerData)||void 0===a?void 0:a.matchID,playerID:String(null===(n=this.state.playerData)||void 0===n?void 0:n.playerID),credentials:null===(i=this.state.playerData)||void 0===i?void 0:i.credential,debug:!1})}else e=Object(g.jsx)(ae,Object(s.a)(Object(s.a)({},this.props),{},{lobbyClient:this.lobbyClient,storePlayerData:this.storePlayerData,playerData:this.state.playerData,startGame:this.startGame}));return Object(g.jsx)("div",{className:"App",children:Object(g.jsx)(f.a,{children:Object(g.jsxs)(W.d,{children:[Object(g.jsx)(W.b,{exact:!0,path:"/",children:Object(g.jsx)(re,{})}),Object(g.jsx)(W.b,{exact:!0,path:"/create",children:Object(g.jsx)(Y,Object(s.a)(Object(s.a)({},this.props),{},{onCreateGameRoom:this.newGame,roomID:t}))}),Object(g.jsx)(W.b,{exact:!0,path:"/rooms/:id",children:e}),Object(g.jsx)(W.b,{children:Object(g.jsx)(W.a,{to:"/"})})]})})})}}]),a}(i.a.Component),ce="SPIRITISLANDWEB_NICKNAME",le=function(e){Object(b.a)(a,e);var t=Object(h.a)(a);function a(e){var n;Object(c.a)(this,a),n=t.call(this,e);var i=localStorage.getItem(ce);return n.state={nickname:i||"",changeRequested:!1},n.setNickname=n.setNickname.bind(Object(u.a)(n)),n.onRequestChange=n.onRequestChange.bind(Object(u.a)(n)),n.resetRequest=n.resetRequest.bind(Object(u.a)(n)),n}return Object(l.a)(a,[{key:"setNickname",value:function(e){this.setState({nickname:e}),this.setState({changeRequested:!1}),localStorage.setItem(ce,e)}},{key:"onRequestChange",value:function(){this.setState({changeRequested:!0})}},{key:"resetRequest",value:function(){this.setState({changeRequested:!1})}},{key:"render",value:function(){return this.state.changeRequested?Object(g.jsx)("div",{children:Object(g.jsx)(J,{nickname:this.state.nickname,onSubmit:this.setNickname,onBack:this.resetRequest})}):Object(g.jsx)(se,Object(s.a)(Object(s.a)({},this.state),{},{requestChangeNickname:this.onRequestChange}))}}]),a}(n.Component);o.a.render(Object(g.jsx)(i.a.StrictMode,{children:Object(g.jsx)(le,{})}),document.getElementById("root"))},34:function(e,t,a){e.exports={button:"style_button__2NB1i","button--orange":"style_button--orange__1f8a3","button--yellow":"style_button--yellow__9QVCF","button--blue":"style_button--blue__3-VhK","button--green":"style_button--green__2ohpW","button--size-small":"style_button--size-small__1EiyD"}},55:function(e,t,a){e.exports={lobbyPage:"style_lobbyPage__13am8",smallLogo:"style_smallLogo__2HGMt",githubLink:"style_githubLink__1Uify"}},71:function(e,t,a){e.exports={text:"style_text__1SbRS",logo:"style_logo__1b3jO"}},94:function(e,t,a){e.exports={input:"style_input__1k1f5"}}},[[154,1,2]]]);
//# sourceMappingURL=main.25ce2824.chunk.js.map